<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>工控期中</title>
  <!--jQuery cdn-->
  <script src="ThirdParty/jquery-3.4.1.min.js"></script>
  <!--exportCsv-->
  <script src="ThirdParty/tableCSVExport.js"></script>

  <!--bootstrap cdn-->
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="ThirdParty/bootstrap-4.4.1.min.css">

  <!--為了讓navbar在點時，會有正確的行動-->
  <!-- <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script> -->

  <!--加入共用的js，為了容易維護locolStorageName-->
  <script>
    document.write('<script src="common.js?timestamp"'+ new Date().getTime()+'><\/script>');
  </script>
</head>
<body>
  <button id="start"> start</button>
  <button id="add" style="display: none;"> add</button>
  <button id="trigger">triger</button>
  <button id="result">GetResult</button>
  <button id="takeABreak">takeABreak</button>
  <textarea id="dangerList"></textarea>
  <table class="table">
    <thead>
      <th>IP</th>
      <th>黑名單</th>
      <th>非黑名單</th>
      <th>其他</th>
    </thead>
    <tbody id="tbody">

    </tbody>
  </table>

  <script type="text/template" id="templateTBody">
    <tr>
      <td>{ip}</td>
      <td grp='{ip}' team='black'>{black}</td>
      <td grp='{ip}' team='notBlack'>{notBlack}</td>
      <td grp='{ip}' team='other'>{other}</td>
    </tr>
  </script>
</body>
</html>

<script>
  $(function(){
    var indexPage = new IndexPage();
    indexPage.Constructor();
  })

  function IndexPage(){
    this.Constructor = constructor;
    // var checkIpArray = ['213.227.167.158','34.116.74.210','188.172.246.181','188.172.246.176','35.210.214.151','37.252.247.107','34.95.44.106','35.215.54.231','188.172.213.74','34.130.135.16','169.54.104.74','103.44.56.68','103.44.56.69','103.44.56.74','103.44.56.75','103.44.56.76','103.44.56.77','103.44.56.78','103.44.56.79','118.26.120.23','118.26.120.24','118.26.120.25','118.26.120.28','118.26.120.34','118.26.120.37','118.26.120.39','101.226.28.202','118.26.120.21','118.26.120.22','118.26.120.26','118.26.120.33','118.26.120.36','118.26.120.38','118.26.120.42','139.198.122.85','203.205.137.236','35.217.17.196','35.228.141.16','46.105.202.126','51.195.5.40','213.227.163.136','213.227.163.135','35.207.191.46','54.93.133.93','85.114.159.93','162.55.6.211','185.188.32.4','213.227.168.144','217.146.23.139','217.146.23.147','94.16.6.164','161.156.67.103','213.227.168.139','213.227.168.147','17.253.87.201','17.253.87.202','17.253.87.203','17.253.87.204','17.253.87.205','17.253.87.206','17.253.87.207','17.253.87.208','31.13.77.17','188.172.201.158','34.92.53.177','103.235.46.191','104.89.102.184','34.131.78.121','34.93.91.7','34.101.114.154','34.101.85.36','35.219.111.231','52.109.76.30','52.109.76.32','52.109.76.33','52.109.76.31','178.255.155.180','178.255.155.181','3.114.95.219','17.253.68.123','17.253.68.125','17.253.68.251','17.253.68.253','18.177.116.10','18.178.22.21','18.178.52.42','18.180.37.25','18.180.83.237','18.182.162.20','34.97.161.128','35.75.128.202','35.189.143.146','35.213.12.39','42.99.128.153','42.99.140.33','42.99.140.49','42.99.140.51','46.51.233.91','52.109.52.77','52.111.232.3','52.111.232.5','52.196.185.138','54.64.181.170','89.187.160.24','103.231.98.194','103.231.98.196','124.146.215.52','139.162.101.180','147.92.146.25','147.92.146.44','147.92.146.131','147.92.157.26','147.92.184.201','147.92.191.86','147.92.191.123','151.101.109.44','151.101.110.49','161.202.200.118','172.104.105.5','172.105.213.147','222.230.178.129','34.84.111.50','37.252.229.190','147.92.146.162','188.42.29.196','34.90.241.47','52.109.88.37','147.75.38.124','52.109.88.38','35.214.142.18','52.109.88.34','52.109.88.35','52.109.88.40','188.172.223.104','188.172.223.108','34.118.72.152','188.172.254.141','3.1.208.138','13.228.111.221','13.228.165.79','13.228.174.207','13.251.3.235','13.251.172.136','13.251.231.155','17.253.82.125','18.139.61.30','18.139.123.140','18.139.158.120','18.140.156.218','18.140.181.101','35.213.145.237','47.241.6.33','47.241.15.43','51.79.162.45','51.79.234.100','52.74.3.254','52.74.162.2','52.74.252.214','52.76.72.251','52.76.251.65','52.109.124.116','52.109.124.127','52.220.142.7','52.220.216.44','52.221.118.220','54.169.14.53','54.251.124.3','54.251.192.147','54.255.231.120','69.173.158.64','74.118.186.44','74.118.186.45','89.207.22.76','103.43.90.54','103.43.90.179','103.43.90.181','103.71.26.125','103.195.32.110','103.229.10.228','103.229.206.240','103.254.153.160','106.10.236.72','159.138.99.220','159.138.102.146','188.172.203.62','34.87.124.238','159.138.82.202','159.138.109.62','37.252.246.100','3.38.19.149','34.64.152.2','37.252.244.158','34.64.233.111','35.216.18.75','188.172.235.149','34.65.65.90','17.253.116.125','17.253.116.253','23.11.69.17','23.11.161.129','23.65.81.213','23.210.236.13','23.210.236.39','23.210.236.88','23.210.236.115','23.210.236.147','23.210.236.204','23.210.236.205','23.210.236.207','23.210.236.210','23.210.236.211','23.210.236.215','23.210.236.231','23.210.237.27','23.210.237.178','23.210.237.235','23.210.238.92','23.210.238.96','31.13.87.5','31.13.87.23','31.13.87.36','34.80.89.126','35.236.145.214','60.251.73.202','60.251.73.206','60.251.73.209','61.31.1.1','61.31.233.1','104.66.135.106','104.66.138.220','104.66.147.162','104.66.153.238','104.66.153.249','117.18.237.29','119.161.14.17','119.161.14.18','119.161.16.11','119.161.16.12','140.112.2.162','140.112.2.164','140.112.8.97','140.112.8.116','140.112.9.213','140.112.145.141','140.112.145.146','140.112.145.153','140.112.161.178','175.99.98.137','175.99.113.50','175.99.118.181','175.99.119.158','203.211.1.84','203.211.2.9','203.211.2.18','203.211.2.24','203.211.2.32','203.211.2.33','203.211.2.34','203.211.2.35','203.211.2.40','203.211.2.41','203.211.2.42','203.211.2.43','203.211.2.48','203.211.2.49','203.211.2.50','203.211.2.98','203.211.2.208','203.211.2.211','203.211.4.137','203.211.4.169','203.211.4.185','203.211.4.187','203.211.4.193','203.211.4.231','203.211.4.242','203.211.6.145','203.211.6.209','203.211.7.98','203.211.7.102','203.211.7.106','203.211.7.110','211.76.117.86','211.76.117.108','211.76.117.109','17.253.117.202','23.11.78.171','23.11.167.72','23.210.236.103','23.210.236.144','23.210.236.229','47.246.37.218','47.246.37.231','60.199.191.27','104.66.153.218','175.99.106.222','175.99.118.156','203.211.0.14','203.211.0.78','203.211.0.143','203.211.0.209','203.211.2.97','203.211.2.193','203.211.2.195','203.211.2.224','203.211.2.253','203.211.4.192','203.211.4.199','211.76.117.141','34.105.225.79','37.252.232.104','37.252.232.105','37.252.232.108','66.155.71.25','66.155.71.150','35.214.40.230','35.214.42.68','37.252.232.103','188.172.198.149','3.140.27.12','3.209.156.238','3.209.160.167','3.216.159.172','3.219.174.244','3.221.88.208','3.227.42.188','3.233.144.188','3.233.144.215','4.79.109.116','8.2.110.165','8.255.192.124','13.33.201.175','13.33.201.211','13.35.6.232','13.35.7.28','13.35.7.43','13.35.7.45','13.35.7.65','13.35.7.66','13.35.7.69','13.35.7.73','13.35.7.117','13.35.7.119','13.35.159.69','13.35.159.87','13.35.163.71','13.35.163.163','13.35.163.177','13.35.163.226','13.35.166.14','13.35.166.15','13.35.166.32','13.35.166.38','13.35.166.62','13.35.166.64','13.35.166.72','13.35.166.80','13.35.166.86','13.35.166.92','13.35.166.96','13.35.166.115','13.35.166.122','13.35.166.123','13.35.166.124','13.35.166.126','13.57.71.61','13.89.179.12','13.107.5.88','13.107.6.171','13.107.21.200','13.107.42.16','17.32.194.2','17.32.194.34','17.36.202.111','17.57.12.11','17.57.21.63','17.57.145.20','17.57.145.21','17.57.145.22','17.57.145.23','17.57.145.24','17.111.103.26','17.125.250.130','17.137.162.3','17.137.166.35','17.142.169.199','17.142.169.200','17.142.171.5','17.142.171.7','17.171.47.28','17.188.128.140','17.188.136.158','17.188.137.165','17.188.137.171','17.188.138.30','17.188.139.30','17.188.142.166','17.188.162.85','17.188.164.254','17.188.167.219','17.188.182.4','17.188.182.68','17.248.223.1','17.248.223.2','17.248.223.3','17.248.223.4','17.248.223.30','17.252.204.85','18.188.240.139','18.235.247.154','23.227.139.243','23.246.56.156','34.94.232.12','34.98.64.218','34.104.35.123','34.117.239.71','34.149.60.21','34.203.81.219','34.213.114.77','34.215.76.123','34.223.153.246','34.235.58.51','34.239.230.101','35.71.131.137','35.164.52.163','35.166.71.61','35.175.165.117','35.185.21.228','35.186.194.101','35.186.226.184','35.190.60.146','35.212.16.125','35.227.159.135','35.227.202.26','38.133.127.191','40.78.253.203','44.237.234.25','44.237.239.19','44.238.127.220','44.240.158.19','44.242.13.161','45.55.121.210','45.57.41.1','45.57.90.1','45.57.91.1','50.112.122.241','50.116.239.135','50.116.239.150','52.1.232.25','52.4.236.19','52.8.217.25','52.10.41.169','52.21.17.140','52.24.26.117','52.25.37.91','52.35.195.250','52.38.7.83','52.39.141.123','52.40.134.57','52.52.71.107','52.53.114.81','52.54.171.221','52.70.184.189','52.71.139.55','52.72.176.167','52.109.2.6','52.109.8.21','52.109.8.24','52.109.8.25','52.109.12.18','52.109.12.19','52.109.12.20','52.109.12.23','52.200.2.97','52.201.168.222','52.223.2.229','54.70.105.250','54.71.121.82','54.84.143.226','54.145.213.67','54.149.4.149','54.149.194.4','54.201.197.201','54.205.113.20','54.210.244.199','54.219.143.85','54.234.153.96','64.233.164.94','64.233.168.94','64.233.187.188','64.233.188.188','64.233.189.188','67.199.150.82','67.199.150.85','67.202.105.21','69.173.151.100','74.125.23.188','74.125.24.94','74.125.193.94','74.125.203.188','74.125.204.188','74.214.196.131','104.26.5.103','104.26.10.240','104.196.95.159','107.178.244.193','108.177.97.188','108.177.125.156','108.177.125.188','130.211.115.4','135.148.122.24','142.93.116.242','142.93.240.20','142.250.78.35','142.250.105.94','142.250.157.155','142.250.157.157','142.251.8.154','142.251.8.156','142.251.36.35','142.251.42.225','142.251.42.226','142.251.42.232','142.251.42.234','142.251.42.246','142.251.43.1','142.251.43.3','142.251.43.4','142.251.43.6','142.251.43.8','142.251.43.10','142.251.43.11','147.135.79.182','150.136.25.38','152.195.61.157','152.195.61.203','152.199.39.108','154.59.122.79','165.22.45.86','172.66.42.247','172.67.28.137','172.67.73.81','172.67.137.245','172.67.214.69','172.217.2.195','172.217.4.35','172.217.18.99','172.217.24.2','172.217.24.3','172.217.24.6','172.217.24.10','172.217.24.14','172.217.24.22','172.217.27.130','172.217.27.138','172.217.27.142','172.217.160.65','172.217.160.66','172.217.160.67','172.217.160.74','172.217.160.77','172.217.160.78','172.217.160.97','172.217.160.98','172.217.160.99','172.217.160.106','172.217.160.110','172.217.160.114','172.217.160.118','172.217.166.67','172.217.167.99','172.217.173.163','192.0.76.3','192.0.77.2','192.0.77.32','192.0.77.37','192.0.78.248','198.8.71.128','204.79.197.200','207.207.55.235','209.54.178.82','209.191.163.208','216.58.199.227','216.58.200.33','216.58.200.34','216.58.200.35','216.58.200.38','216.58.200.40','216.58.200.42','216.58.200.46','216.58.200.50','216.58.206.163','216.239.32.21','216.239.32.116','216.239.32.117','216.239.34.117','13.35.166.20','13.35.166.31','13.35.166.61','13.35.166.100','13.35.166.101','13.35.166.107','13.35.166.109','15.197.229.237','17.32.194.12','17.32.194.43','17.56.48.13','17.137.184.130','17.142.171.6','17.167.200.72','17.171.47.104','17.188.128.144','17.188.129.19','17.188.131.13','17.188.132.171','17.188.133.34','17.188.133.39','17.188.134.32','17.188.134.60','17.188.134.161','17.188.134.169','17.188.135.31','17.188.138.165','17.188.160.223'
    //   ,'17.188.161.93','17.188.162.23','17.188.164.57','17.188.164.94','17.188.165.155','17.188.166.160','17.188.166.214','17.188.182.196','17.188.183.4','17.242.142.142','17.248.223.32','17.248.223.33','18.205.94.230','23.246.56.133','23.246.56.134','23.246.56.150','23.246.56.151','23.246.56.157','34.98.33.162','34.106.86.104','34.120.195.249','34.125.80.210','34.150.165.240','34.196.41.213','34.201.142.47','34.202.141.223','34.211.138.90','34.225.241.75','34.237.104.204','35.81.92.226','35.81.198.46','35.82.23.172','35.155.235.224','35.161.21.238','35.162.161.22','35.167.194.160','35.169.37.153','35.190.88.7','35.212.207.78','35.217.93.191','35.219.153.27','44.232.75.216','44.232.253.98','44.234.232.238','44.237.126.180','44.240.89.178','44.242.60.85','45.57.75.168','52.10.248.239','52.11.35.251','52.36.101.116','52.36.169.40','52.38.120.169','52.41.92.51','52.44.89.131','52.55.122.255','52.84.150.66','52.88.180.59','52.88.208.102','52.89.79.226','52.89.176.216','52.109.8.19','52.109.8.20','52.109.8.22','52.109.12.22','52.109.12.24','52.175.198.74','54.69.48.209','54.69.66.94','54.70.178.119','54.148.89.138','54.174.152.186','54.210.64.71','54.218.116.118','64.233.166.94','67.195.228.56','69.28.62.189','74.125.10.138','74.125.164.40','142.250.65.227','142.250.184.195','142.251.8.188','142.251.40.195','142.251.42.237','142.251.43.16','142.251.43.22','172.67.75.39','172.67.181.80','172.217.4.195','172.217.13.227','172.217.16.35','172.217.19.67','172.217.27.195','172.217.28.99','172.217.31.131','172.217.31.195','172.217.31.227','172.217.166.163','172.217.167.35','172.217.168.3','172.217.168.163','172.217.168.195','172.217.169.35','173.194.51.249','209.85.232.94','216.58.194.163','216.58.196.163','216.58.200.54','216.58.204.99','216.58.213.3','216.58.215.35','216.239.32.3','216.239.36.117','216.239.38.117','0.0.0.0','23.11.166.146','23.210.236.196','104.16.19.94','104.16.94.65','104.16.124.175','104.16.148.64','104.16.149.64','104.18.10.79','104.18.10.207','104.18.13.5','104.18.30.182','104.18.131.89','104.20.184.68','104.20.185.68','104.21.29.144','104.21.80.129','104.22.2.111','104.22.3.111','104.22.56.126','110.238.107.47','118.26.32.18','142.251.42.227','142.251.42.238','142.251.43.2','142.251.43.14','162.159.152.4','162.159.153.4','169.254.105.36','192.168.0.1','192.168.0.11','192.168.0.13','192.168.0.14','192.168.0.15','192.168.0.17','192.168.0.240','192.168.0.255','192.168.2.10','192.168.100.1','203.211.2.241','224.0.0.22','224.0.0.251','239.255.255.250','255.255.255.255'];
    
    //BlackList
    var checkIpArray=['210.56.23.100','82.117.194.229','182.160.109.178','121.54.54.130','194.44.152.136','211.214.161.228','213.81.164.57','213.87.129.252','83.238.208.55','87.121.77.67','91.187.113.54','91.229.216.13'];
    var api = 'https://zh-hant.ipshu.com/blackcheck_api?checkurl=';
      
    //Reference: https://zh-hant.ipshu.com/blacklist_check
    var urlArray = ['0spam.fusionzero.com','all.s5h.net','b.barracudacentral.org','bl.spamcop.net','block.dnsbl.sorbs.net','bogons.cymru.com','cart00ney.surriel.com','cbl.abuseat.org','dnsbl.sorbs.net','dnsbl-1.uceprotect.net','dnsbl-2.uceprotect.net','dnsbl-3.uceprotect.net','dul.dnsbl.sorbs.net','escalations.dnsbl.sorbs.net','black.junkemailfilter.com','http.dnsbl.sorbs.net','ips.backscatterer.org','l2.apews.org','misc.dnsbl.sorbs.net','new.dnsbl.sorbs.net','old.dnsbl.sorbs.net','pbl.spamhaus.org','psbl.surriel.com','sbl.spamhaus.org','smtp.dnsbl.sorbs.net','ubl.unsubscore.com','web.dnsbl.sorbs.net','xbl.spamhaus.org','zen.spamhaus.org','zombie.dnsbl.sorbs.net','rbl.megarbl.net'];
    var count = 0;

    function constructor()
    {
      $('#start').on('click', function(){
        
        var html = '';
        var template = $('#templateTBody').html();
         
        for(var i = 0; i < checkIpArray.length; i++)
        {
          html += template.replace(/{ip}/g, checkIpArray[i])
                .replace(/{black}/g, 0).replace(/{notBlack}/g, 0).replace(/{other}/g, 0)
        }
        $('#tbody').html(html);
        console.log('checkIpCount:' + checkIpArray.length);
      })

      $('#add').on('click', function(){
        if(count<checkIpArray.length)
        {
          currentIp = checkIpArray[count];
          var notBlackListCount = 0;
          var isBlackListCount = 0;
          var unknownCount =0;
          for(var j = 0; j < urlArray.length; j++)
          {
            var tempUrl = api+urlArray[j]+'&ip='+currentIp;
            Common.SendRequest(tempUrl, function(resp){
              if(resp.state == 0){
                notBlackListCount = notBlackListCount+1;
              }
              else if (resp.state == 1){
                isBlackListCount = isBlackListCount+1;
              }
              else{
                unknownCount = unknownCount+1;
              }
              $('[grp="'+currentIp+'"][team=black]').text(isBlackListCount);
              $('[grp="'+currentIp+'"][team=notBlack]').text(notBlackListCount);
              $('[grp="'+currentIp+'"][team=other]').text(unknownCount);
              if(isBlackListCount+notBlackListCount+unknownCount == urlArray.length)
              {
                console.log('OK:'+count);
              }
            }, function(resp){
              console.log('Error:'+resp.statusText);
            });
        }
        count++;
        }
        else{
          $('#takeABreak').click();
          console.log('Finish');
        }
      })
      
      var timer;
      var takeABreakTimer;
      var waitSec = 20000;
      $('#trigger').on('click', function(){
        timer = setInterval(function(){
            $('#add').click();
          }, waitSec);

          takeABreakTimer = setInterval(function(){
            $('#takeABreak').click();
          },waitSec*checkIpArray.length);
      })

      $('#takeABreak').on('click', function(){
        clearInterval(timer);
        clearInterval(takeABreakTimer);

        console.log('Take a break;');
      })

      $('#result').on('click', function(){
        var blackCounts=$('[team=black]');
        var result = '';
        for(var i = 0; i < blackCounts.length; i++)
        {
          if(parseInt(blackCounts[i].innerText) > 3)
          {
            result +=blackCounts[i].getAttribute('grp')+', ';
          }
        }
        $('#dangerList').val(result);
      })
    }
  } 

</script>